<beast version="2.0"
       namespace="beast.pkgmgmt:beast.base.core:beast.base.inference
                 :beast.core.util
                 :beast.core.parameter
                 :beast.base.evolution.alignment
                 :beast.evolution.likelihood
                 :beast.evolution.tree
                 :beast.base.evolution.tree.coalescent
                 :beast.evolution.sitemodel
                 :beast.evolution.substitutionmodel
                 :beast.evolution.operators
                 :beast.math.distributions
                 :feast.simulation
                 :coalre.network
                 :coalre.statistics
                 :coalre.simulator
                 :coalre.operators
                 :coalre.distribution">

    <!-- <run spec="coupledMCMC.CoupledMCMC" chains="100"  chainLength="1000000000"  resampleEvery="100000" logHeatedChains="true" optimise="false" deltaTemperature="0.0" storeEvery="10000"> -->
    <run spec="MCMC" chainLength="100000000" storeEvery="100000">

        <state>
            <stateNode id="network" spec="SimulatedCoalescentNetwork" nSegments="8" enableSegmentTreeUpdate="false">
                <populationModel spec="beast.base.evolution.tree.coalescent.ConstantPopulation">
                    <popSize spec="beast.base.inference.parameter.RealParameter" value="1.0"/>
                </populationModel>

                <reassortmentRate spec="beast.base.inference.parameter.RealParameter" value="0"/>

                <traitSet spec="beast.base.evolution.tree.TraitSet" traitname="date-backward" id="traitSet">
                    <taxa spec="beast.base.evolution.alignment.TaxonSet" id="taxonSet">
                        <taxon spec="Taxon" id="t1"/>
                        <taxon spec="Taxon" id="t2"/>
                        <taxon spec="Taxon" id="t3"/>
                        <taxon spec="Taxon" id="t4"/>
                        <taxon spec="Taxon" id="t5"/>
                    </taxa>

                    t1=0, t2=0.1, t3=0.2, t4=0.3, t5=0.4
                </traitSet>



            </stateNode>
            <tree id="tree1" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
            <tree id="tree2" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
            <tree id="tree3" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
            <tree id="tree4" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
            <tree id="tree5" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
            <tree id="tree6" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
            <tree id="tree7" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
            <tree id="tree8" spec="beast.base.evolution.tree.Tree" name="stateNode" taxonset="@taxonSet"/>
        </state>

        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="0">
            <segmentTree idref="tree1" />
        </init>
        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="1">
            <segmentTree idref="tree2" />
        </init>
        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="2">
            <segmentTree idref="tree3" />
        </init>
        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="3">
            <segmentTree idref="tree4" />
        </init>
        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="4">
            <segmentTree idref="tree5" />
        </init>
        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="5">
            <segmentTree idref="tree6" />
        </init>         
        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="6">
            <segmentTree idref="tree7" />
        </init>
        <init spec="coalre.network.SegmentTreeInitializer" network="@network" segmentIndex="7">
            <segmentTree idref="tree8" />
        </init>



        <distribution id="coalDensity" spec="CoalescentWithReassortment" >
            <networkIntervals spec="NetworkIntervals" network="@network"/>

            <populationModel id="splinePop" spec="coalre.dynamics.SkygrowthNeDynamics">
                <logNe id="logInfected" spec="beast.base.inference.parameter.RealParameter" value="5 1 2 -1 0 0"/>
                <rateShifts id="rateShifts" spec="beast.base.inference.parameter.RealParameter" value="0 1 2 3 4 5"/>
            </populationModel>
            <timeVaryingReassortmentRates id="splinePop2" spec="coalre.dynamics.SkygrowthReassortmentRatesFromSkygrowthNe">
                <neToReassortment id="reassortmentRate" spec="beast.base.inference.parameter.RealParameter" value="-1 -1 0 1 -1 -1"/>
                <rateShifts id="rateShifts2" spec="beast.base.inference.parameter.RealParameter" value="0 1 2 3 4 5"/>
            </timeVaryingReassortmentRates>
        </distribution>

        <!-- <operator id="Expo" spec="AddRemoveReassortmentExponential" network="@network" weight="3.0" size="1">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->


        <!-- <operator id="oneSegExpo" spec="AddRemoveReassortment" network="@network" weight="2.0" edgeDistance="6" lambda="5" localMove="true" divertOneSegment="true">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <operator id="oneSegCoal" spec="AddRemoveReassortmentCoalescent" network="@network" coalescentWithReassortment="@coalDensity" weight="5.0" lambda="0.1" divertOneSegment="false">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>

        <!-- <operator id="ancestorCoal" spec="AddRemoveReassortmentCoalescent" randomlySampleAttachmentEdge="true" network="@network" useDirectAncestorsOnly="true" coalescentWithReassortment="@coalDensity" weight="10.0" lambda="0.1" divertOneSegment="false">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator id="unifrom" spec="BranchUniform" network="@network" weight="1.0" lambda="0.1">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->





        <!-- <operator spec="AddRemoveReassortmentCoalescent" randomlySampleAttachmentEdge="false" network="@network" coalescentWithReassortment="@coalDensity" weight="1.0" divertOneSegment="false">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator spec="AddRemoveReassortmentExponential" randomlySampleAttachmentEdge="false" network="@network" coalescentWithReassortment="@coalDensity" weight="1.0" divertOneSegment="false">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator spec="AddRemoveReassortmentExponential" network="@network" weight="1.0" divertOneSegment="true">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->



        <!-- <operator spec="AddRemoveReassortment" network="@network" weight="5.0" divertOneSegment="false" alpha="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>

        <operator spec="AddRemoveReassortment" network="@network" weight="5.0" divertOneSegment="true" alpha="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator spec="AddRemoveReassortmentCoalescent" randomlySampleAttachmentEdge="false" network="@network" coalescentWithReassortment="@coalDensity" weight="1.0" lambda="1" divertOneSegment="true">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator spec="DivertSegmentOperator" network="@network" weight="1.0" divertOneSegment="true">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <operator spec="AddRemoveAndResimulate" coalescentWithReassortment="@coalDensity" divertOneSegment="false" lambda="0" network="@network" weight="1">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>

        <operator spec="DivertSegmentAndResimulate" coalescentWithReassortment="@coalDensity" divertOneSegment="false" lambda="0" network="@network" weight="1">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>



        <!-- <operator id="networkGibbsCwR.alltrees" spec="coalre.operators.GibbsOperatorAboveSegmentRoots" network="@network"  coalescentWithReassortment="@coalDensity" weight="1">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

      <!-- <operator id="NetworkScale" spec="NetworkScaleOperator" network="@network" weight="1.0" scaleFactor="0.9">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>

      <operator id="NetworkScaleRootOnly" spec="NetworkScaleOperator" network="@network" scaleRootOnly="true" weight="1.0" scaleFactor="0.9">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>

        <operator id="IntervalsScaler" spec="NetworkScaleOperator" network="@network" scaleIntervalsIndependently="true" weight="1.0" scaleFactor="0.9">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>

        <operator id="slide" spec="SubNetworkSlide"  network="@network" weight="1.0" size="10">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->
        <!-- <operator id="slide2" spec="SubNetworkLeap" randomlySampleAttachmentEdge="true"  network="@network" weight="5.0" size="20">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->
        <!-- <operator id="Narrow" spec="NetworkExchange" isNarrow="true"  network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>
        <operator id="Wide" spec="NetworkExchange" isNarrow="false"  network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator id="SPR" spec="NetworkSPR"  network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator id="SPRoneSeg" spec="NetworkSPR" divertOneSegment="true"  network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator id="treeLeap" spec="AddRemoveReassortmentExponential" network="@network" weight="5.0" size="2.0" lambda="0" optimise="false">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->


        <!-- <operator id="ReassortmentSlide" spec="SubNetworkLeap" network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator>

        <operator id="ReassortmentSlide2" randomlySampleAttachmentEdge="false" spec="SubNetworkLeap" network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->

        <!-- <operator id="RootsOnly" segmentRootOnly="true" spec="SubNetworkLeap" network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->



        <!-- <operator id="ReassortmentSlide3" spec="SubNetworkSlide" network="@network" weight="1.0">
            <segmentTree idref="tree1" />
            <segmentTree idref="tree2" />
            <segmentTree idref="tree3" />
            <segmentTree idref="tree4" />
            <segmentTree idref="tree5" />
            <segmentTree idref="tree6" />
            <segmentTree idref="tree7" />
            <segmentTree idref="tree8" />
        </operator> -->




        <logger spec="Logger" logEvery="1000" mode="tree" fileName="$(filebase).trees">
            <log idref="network"/>
        </logger>

        <logger spec="Logger" logEvery="10000" fileName="$(filebase).log">
            <log spec="NetworkStatsLogger" network="@network"/>
            <log spec="ReassortmentStatsLogger" network="@network"/>
        </logger>

        <logger spec="Logger" logEvery="10000">
            <log spec="NetworkStatsLogger" network="@network"/>
            <log idref="coalDensity"/>
        </logger>
    </run>

</beast>
